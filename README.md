# TuneWave

**TuneWave – это платформа, где пользователи могут находить единомышленников по музыкальным вкусам, слушать треки вместе в реальном времени, обсуждать музыку и открывать новые жанры. Алгоритм рекомендаций подбирает комнаты с музыкой и людьми, а также предлагает интересные треки на основе предпочтений.**

**Технологический стек**

**Backend:**
 - **Язык: Python**
 - **Фреймворк: FastAPI**
 - **База данных: PostgreSQL (основная)**
 - **ORM: SQLAlchemy**
 - **Migration: Alembic**
 - **Аутентификация: OAuth2 (Google/Spotify)**

**DevOps:**
 - **Контейнеризация: Docker**
 - **CI/CD: GitLab**
 - **Хостинг: https://www.heroku.com**

**Frontend:**
 - **Язык: TypeScript/JavaScript**
 - **Фреймворк: React**
 - **Стилизация: Tailwind CSS**

**Дополнительно**
 - **WebSockets – для синхронизации прослушивания и чатов**
 - **Redis – для кеширования**
 - **RabbitMQ – для асинхронной обработки задач (отправка почты, фоновая обработка данных Spotify, уведомления) и надежной очереди сообщений**  

**Минимальный функционал для теста (MVP):**
 1. Регистрация и авторизация (OAuth через Google/Spotify/). 
 2. Создание комнат (публичные и приватные). 
 3. Подключение к комнате (прослушивание музыки в реальном времени). 
 4. Добавление треков в очередь . 
 5. Чат в комнате (основной способ общения).
 6. Рекомендации комнат на основе жанров и истории прослушиваний.
 7. История прослушиваний (в профиле пользователя).


# Docs API

---

Вот документация к вашему API в едином стиле:

## WebSocket чат

### `GET /ws/chat/{room_id}`

**Описание:**  
WebSocket эндпоинт для подключения к чату в комнате.

**Параметры:**

| Название | Тип  | Местоположение | Описание                  |
|----------|------|----------------|---------------------------|
| room_id  | UUID | path           | Уникальный ID комнаты     |
| token    | str  | query          | Токен аутентификации      |

**Особенности:**  
- Отправка и получение сообщений в реальном времени  
- Сообщения в формате JSON, ключ `text`  
- Рассылка сообщений всем участникам  
- Уведомление при выходе пользователя  

---

## User API

### `GET /users/me`

**Описание:**  
Получить профиль текущего пользователя.

**Аутентификация:** Да (JWT)

**Ответ:**  
`UserResponse` - данные профиля пользователя.

**Ограничения:**  
10 запросов в минуту

### `PUT /users/{user_id}`

**Описание:**  
Обновить профиль пользователя.

**Параметры:**

| Название | Тип  | Описание            |
|----------|------|---------------------|
| user_id  | UUID | ID пользователя     |

**Тело запроса:**  
`UserUpdate`

**Ответ:**  
Обновленный профиль `UserResponse`

### `POST /users/me/avatar`

**Описание:**  
Загрузить аватар пользователя.

**Форма данных:**  
`avatar_file` (UploadFile)

**Ответ:**  
`UserResponse` с обновленным URL аватара

**Ограничения:**  
5 запросов в минуту

### `GET /users/{user_id}`

**Описание:**  
Получить публичную информацию о пользователе.

**Параметры:**  
`user_id` - UUID

**Ответ:**  
`UserResponse`

**Ограничения:**  
20 запросов в минуту

---

## Track API

### `GET /track/{spotify_id}`

**Описание:**  
Получить трек по Spotify ID.

**Параметры:**

| Название   | Тип  | Описание         |
|------------|------|------------------|
| spotify_id | str  | ID трека Spotify |

**Ответ:**  
`TrackBase` с информацией о треке

**Ограничения:**  
15 запросов в минуту

### `POST /track/`

**Описание:**  
Создать трек на основе данных Spotify.

**Тело запроса:**  
`TrackCreate`

**Ответ:**  
Созданный трек `TrackCreate`

**Ограничения:**  
10 запросов в минуту

---

## Favorite Track API

### `GET /favorites/me`

**Описание:**  
Получить любимые треки текущего пользователя.

**Ответ:**  
`list[FavoriteTrackResponse]`

**Ограничения:**  
15 запросов в минуту

### `POST /favorites/me`

**Описание:**  
Добавить трек в избранное.

**Тело запроса:**  
`FavoriteTrackAdd`

**Ответ:**  
`FavoriteTrackResponse`

**Ограничения:**  
5 запросов в минуту

### `DELETE /favorites/me/{spotify_id}`

**Описание:**  
Удалить трек из избранного.

**Параметры:**  
`spotify_id` - str

**Ответ:**  
Статус операции

**Ограничения:**  
5 запросов в минуту

### `GET /favorites/{user_id}`

**Описание:**  
Получить избранные треки пользователя.

**Параметры:**  
`user_id` - UUID

**Ответ:**  
`list[FavoriteTrackResponse]`

**Ограничения:**  
10 запросов в минуту

---

## Room API

### Основные операции

| Метод | URL                | Описание                          | Требования              |
|-------|--------------------|----------------------------------|------------------------|
| POST  | `/rooms/`          | Создать комнату                  | Аутентификация         |
| PUT   | `/rooms/{room_id}` | Обновить комнату                 | Владелец комнаты       |
| DELETE| `/rooms/{room_id}` | Удалить комнату                  | Владелец комнаты       |
| POST  | `/rooms/{room_id}/join` | Присоединиться к комнате      | Аутентификация         |
| POST  | `/rooms/{room_id}/leave` | Покинуть комнату             | Участник комнаты       |
| GET   | `/rooms/{room_id}/members` | Получить участников       | Нет                   |
| GET   | `/rooms/by-name/`  | Найти комнату по названию        | Нет                   |
| GET   | `/rooms/my-rooms`  | Получить комнаты пользователя    | Аутентификация         |
| GET   | `/rooms/`          | Получить все комнаты             | Нет                   |
| GET   | `/rooms/{room_id}` | Получить комнату по ID           | Нет                   |

**Ограничения:**  
10 запросов в минуту (кроме создания комнаты - 5 запросов)

### Управление участниками

| Метод | URL                          | Описание                          |
|-------|------------------------------|----------------------------------|
| PUT   | `/rooms/{room_id}/members/{user_id}/role` | Изменить роль участника |
| POST  | `/rooms/{room_id}/invite/{user_id}` | Пригласить пользователя    |

**Требования:**  
Владелец или модератор комнаты

**Ограничения:**  
5 запросов в минуту

### Баны

| Метод | URL                          | Описание                  |
|-------|------------------------------|--------------------------|
| POST  | `/rooms/{room_id}/members/{user_id}/ban` | Забанить пользователя |
| DELETE| `/rooms/{room_id}/members/{user_id}/ban` | Разбанить пользователя |

**Требования:**  
Владелец комнаты

**Ограничения:**  
5 запросов в минуту

### Очередь треков

| Метод | URL                          | Описание                  |
|-------|------------------------------|--------------------------|
| POST  | `/rooms/{room_id}/queue`     | Добавить трек в очередь  |
| GET   | `/rooms/{room_id}/queue`     | Получить очередь треков  |
| DELETE| `/rooms/{room_id}/queue/{association_id}` | Удалить трек из очереди |

**Требования:**  
Владелец комнаты (для POST/DELETE)

**Ограничения:**  
10 запросов в минуту

---

## Chat API

### `GET /chat/{room_id}`

**Описание:**  
Получить историю сообщений с пагинацией.

**Параметры:**

| Название         | Тип        | Описание                        |
|------------------|------------|--------------------------------|
| room_id          | UUID       | ID комнаты                     |
| limit            | int        | Лимит сообщений (обязательно)   |
| before_timestamp | datetime   | Пагинация - получить старые     |

**Ответ:**  
`list[MessageResponse]`

**Ограничения:**  
10 запросов в минуту

### `POST /chat/{room_id}`

**Описание:**  
Отправить сообщение в чат.

**Тело запроса:**  
`MessageCreate`

**Ответ:**  
`MessageResponse`

**Ограничения:**  
5 запросов в 5 секунд

---

## Friendship API

### Основные операции

| Метод | URL                          | Описание                  |
|-------|------------------------------|--------------------------|
| POST  | `/friendships/send-request`  | Отправить запрос в друзья |
| PUT   | `/friendships/{id}/accept`   | Принять запрос           |
| PUT   | `/friendships/{id}/decline`  | Отклонить запрос         |
| DELETE| `/friendships/{id}`          | Удалить дружбу           |

**Ограничения:**  
5 запросов в минуту

### Получение данных

| Метод | URL                          | Описание                  |
|-------|------------------------------|--------------------------|
| GET   | `/friendships/my-friends`    | Получить друзей          |
| GET   | `/friendships/my-send-requests` | Отправленные запросы |
| GET   | `/friendships/my-received-requests` | Полученные запросы |

**Ограничения:**  
15 запросов в минуту

---

## Notification API

### `GET /notifications/my`

**Описание:**  
Получить уведомления пользователя.

**Параметры:**

| Название | Тип | Описание              | Default |
|----------|-----|----------------------|---------|
| limit    | int | Лимит уведомлений     | 10      |
| offset   | int | Смещение для пагинации | 0       |

**Ответ:**  
`list[NotificationResponse]`

**Ограничения:**  
10 запросов в минуту

### `PUT /notifications/{id}/mark-read`

**Описание:**  
Пометить уведомление как прочитанное.

**Ответ:**  
`NotificationResponse`

**Ограничения:**  
5 запросов в минуту

### `DELETE /notifications/{id}`

**Описание:**  
Удалить уведомление.

**Ответ:**  
Статус операции

**Ограничения:**  
5 запросов в минуту

---

## Ban API

### `GET /ban/my-issued`

**Описание:**  
Получить баны, выданные текущим пользователем.

**Ответ:**  
`list[BanResponse]`

### `GET /ban/my-received`

**Описание:**  
Получить баны, полученные текущим пользователем.

**Ответ:**  
`list[BanResponse]`

**Ограничения:**  
15 запросов в минуту

---

## Auth API

### `GET /auth/config`

**Описание:**  
Получить OAuth конфигурации для фронтенда.

**Ответ:**  
`FrontendConfig`

**Ограничения:**  
15 запросов в минуту

### Google OAuth

| Метод | URL               | Описание                                  |
|-------|-------------------|-------------------------------------------|
| GET   | `/auth/google/login` | Перенаправление на авторизацию Google |
| GET   | `/auth/google/callback` | Обработка callback, выдача JWT |

### Spotify OAuth

| Метод | URL                  | Описание                                  |
|-------|----------------------|-------------------------------------------|
| GET   | `/auth/spotify/callback` | Обработка callback Spotify, выдача JWT |

После успешной аутентификации через OAuth происходит редирект на фронтенд с JWT-токеном в параметре URL.
