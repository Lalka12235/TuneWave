# TuneWave

**TuneWave – это платформа, где пользователи могут находить единомышленников по музыкальным вкусам, слушать треки вместе в реальном времени, обсуждать музыку и открывать новые жанры. Алгоритм рекомендаций подбирает комнаты с музыкой и людьми, а также предлагает интересные треки на основе предпочтений.**

**Технологический стек**

**Backend:**
 - **Язык: Python**
 - **Фреймворк: FastAPI**
 - **База данных: PostgreSQL (основная)**
 - **ORM: SQLAlchemy**
 - **Migration: Alembic**
 - **Аутентификация: OAuth2 (Google/Spotify)**

**DevOps:**
 - **Контейнеризация: Docker**
 - **CI/CD: GitLab**
 - **Хостинг: https://www.heroku.com**

**Frontend:**
 - **Язык: TypeScript/JavaScript**
 - **Фреймворк: React**
 - **Стилизация: Tailwind CSS**

**Дополнительно**
 - **WebSockets – для синхронизации прослушивания и чатов**
 - **Redis – для кеширования**

**Минимальный функционал для теста (MVP):**
 1. Регистрация и авторизация (OAuth через Google/Spotify/). 
 2. Создание комнат (публичные и приватные). 
 3. Подключение к комнате (прослушивание музыки в реальном времени). 
 4. Добавление треков в очередь . 
 5. Чат в комнате (основной способ общения).
 6. Рекомендации комнат на основе жанров и истории прослушиваний.
 7. История прослушиваний (в профиле пользователя).


# Docs API

---

## WebSocket чат

### `GET /ws/chat/{room_id}`

**Описание:**  
WebSocket эндпоинт для подключения к чату в комнате.

**Параметры:**

| Название | Тип  | Местоположение | Описание                  |
|----------|------|----------------|---------------------------|
| room_id  | UUID | path           | Уникальный ID комнаты     |
| token    | str  | query          | Токен аутентификации      |

**Особенности:**  
- Отправка и получение сообщений в реальном времени.  
- Сообщения в формате JSON, ключ `text`.  
- Рассылка сообщений всем участникам.  
- Уведомление при выходе пользователя.

---

## User API

### `GET /users/me`

**Описание:**  
Получить профиль текущего пользователя.

**Аутентификация:** Yes (JWT)

**Ответ:**  
`UserResponse` — данные профиля пользователя.

---

## Track API

### `GET /track/{spotify_id}`

**Описание:**  
Получить трек по Spotify ID.

**Параметры:**

| Название   | Тип  | Местоположение | Описание         |
|------------|------|----------------|------------------|
| spotify_id | str  | path           | ID трека Spotify |

**Ответ:**  
`TrackBase` с информацией о треке.

### `POST /track/`

**Описание:**  
Создать трек на основе данных Spotify.

**Тело запроса:**  
`TrackCreate`

**Ответ:**  
Созданный трек `TrackCreate`.

---

## Spotify Public API (без аутентификации)

### `GET /spotify-public/search/tracks`

**Описание:**  
Поиск треков Spotify по запросу.

**Параметры:**

| Название | Тип | Описание                        | default | Ограничения |
|----------|-----|--------------------------------|---------|-------------|
| query    | str | Поисковый запрос               | —       | —           |
| limit    | int | Максимальное количество треков | 10      | от 1 до 50  |

**Ответ:**  
Результаты поиска — `dict[str, Any]`.

---

## Spotify API (с аутентификацией)

### `GET /spotify/search/tracks`

**Описание:**  
Поиск треков Spotify с учетом аутентификации пользователя.

**Аутентификация:** Yes (JWT)

**Параметры:**  
Аналогично `spotify-public`.

**Ответ:**  
Результаты поиска — `dict[str, Any]`.

---

## Room API

### `POST /rooms/`

**Описание:**  
Создать комнату. Владелец — текущий пользователь.

**Тело запроса:**  
`RoomCreate`

**Ответ:**  
`RoomResponse`

### `PUT /rooms/{room_id}`

**Описание:**  
Обновить комнату (только для владельца).

**Параметры:**

| Название | Тип  | Описание            |
|----------|------|---------------------|
| room_id  | UUID | ID комнаты          |

**Тело запроса:**  
`RoomUpdate`

**Ответ:**  
Обновленная комната `RoomResponse`.

### `DELETE /rooms/{room_id}`

**Описание:**  
Удалить комнату (только для владельца).

**Параметры:**  
`room_id` — UUID.

**Ответ:**  
Статус операции.

### `POST /rooms/{room_id}/join`

**Описание:**  
Присоединиться к комнате. Для приватных комнат требуется пароль.

**Параметры:**  
`room_id` — UUID.

**Тело запроса:**  
`JoinRoomRequest` (с паролем)

**Ответ:**  
Информация о комнате.

### `POST /rooms/{room_id}/leave`

**Описание:**  
Покинуть комнату.

**Параметры:**  
`room_id` — UUID.

**Ответ:**  
Статус операции.

### `GET /rooms/{room_id}/members`

**Описание:**  
Получить список участников комнаты.

**Параметры:**  
`room_id` — UUID.

**Ответ:**  
Список `UserResponse`.

### `GET /rooms/by-name/`

**Описание:**  
Получить комнату по названию.

**Параметры:**  
`name` — str, query.

**Ответ:**  
`RoomResponse`

### `GET /rooms/my-rooms`

**Описание:**  
Получить список комнат текущего пользователя.

**Аутентификация:** Yes

**Ответ:**  
Список комнат.

### `GET /rooms/`

**Описание:**  
Получить список всех комнат.

**Ответ:**  
Список комнат.

### `GET /rooms/{room_id}`

**Описание:**  
Получить комнату по UUID.

**Параметры:**  
`room_id` — UUID.

**Ответ:**  
`RoomResponse`

---

### Очередь треков

| Метод  | URL                          | Описание                          | Требования              |
|--------|------------------------------|----------------------------------|------------------------|
| POST   | `/rooms/{room_id}/queue`     | Добавить трек в очередь          | Владелец комнаты       |
| GET    | `/rooms/{room_id}/queue/{association_id}` | Получить очередь треков           | Нет                   |
| DELETE | `/rooms/{room_id}/queue{association_id}`  | Удалить трек из очереди          | Владелец комнаты       |

---

## Chat API (REST)

### `GET /chat/{room_id}`

**Описание:**  
Получить историю сообщений с пагинацией.

**Параметры:**

| Название         | Тип        | Местоположение | Описание                        |
|------------------|------------|----------------|--------------------------------|
| room_id          | UUID       | path           | Уникальный ID комнаты           |
| limit            | int        | query          | Кол-во сообщений (обязательно)  |
| before_timestamp | datetime   | query (opt)    | Пагинация — получить старые     |

**Ответ:**  
`list[MessageResponse]`

### `POST /chat/{room_id}`

**Описание:**  
Создать новое сообщение в комнате.

**Тело запроса:**  
`MessageCreate` с текстом.

**Ответ:**  
Созданное сообщение `MessageResponse`.

---

## Auth API

### `GET /auth/config`

**Описание:**  
Получить публичные OAuth конфигурации (Google, Spotify).

**Ответ:**  
`FrontendConfig`

---

### Google OAuth

| Метод | URL               | Описание                                  |
|-------|-------------------|-------------------------------------------|
| GET   | `/auth/google/login` | Перенаправление на страницу авторизации Google |
| GET   | `/auth/google/callback` | Обработка callback, выдача JWT, редирект на фронтенд |

---

### Spotify OAuth

| Метод | URL                  | Описание                                         |
|-------|----------------------|--------------------------------------------------|
| GET   | `/auth/spotify/callback` | Обработка callback Spotify, получение токенов и данных пользователя, редирект с JWT |

---
